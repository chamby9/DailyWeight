IvVzZSBjbGllbnQiOwoKaW1wb3J0IHsgY3JlYXRlQ29udGV4dCwgdXNlQ29udGV4dCwgdXNlRWZmZWN0LCB1c2VTdGF0ZSwgdXNlUmVmIH0gZnJvbSAncmVhY3QnOwppbXBvcnQgeyBVc2VyIH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJzsKaW1wb3J0IHsgc3VwYWJhc2UgfSBmcm9tICdAL2xpYi9zdXBhYmFzZSc7Cgp0eXBlIEF1dGhDb250ZXh0VHlwZSA9IHsKICB1c2VyOiBVc2VyIHwgbnVsbDsKICBsb2FkaW5nOiBib29sZWFuOwp9OwoKY29uc3QgQXV0aENvbnRleHQgPSBjcmVhdGVDb250ZXh0PEF1dGhDb250ZXh0VHlwZT4oewogIHVzZXI6IG51bGwsCiAgbG9hZGluZzogdHJ1ZSwKfSk7CgpleHBvcnQgZnVuY3Rpb24gQXV0aFByb3ZpZGVyKHsgY2hpbGRyZW4gfTogeyBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlIH0pIHsKICBjb25zdCBbdXNlciwgc2V0VXNlcl0gPSB1c2VTdGF0ZTxVc2VyIHwgbnVsbD4obnVsbCk7CiAgY29uc3QgW2xvYWRpbmcsIHNldExvYWRpbmddID0gdXNlU3RhdGUodHJ1ZSk7CiAgY29uc3QgaXNJbml0aWFsaXplZCA9IHVzZVJlZihmYWxzZSk7CgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAoaXNJbml0aWFsaXplZC5jdXJyZW50KSByZXR1cm47CiAgICBpc0luaXRpYWxpemVkLmN1cnJlbnQgPSB0cnVlOwoKICAgIC8vIEdldCBpbml0aWFsIHNlc3Npb24KICAgIGNvbnN0IGdldEluaXRpYWxTZXNzaW9uID0gYXN5bmMgKCkgPT4gewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHsgZGF0YTogeyBzZXNzaW9uIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0U2Vzc2lvbigpOwogICAgICAgIGlmIChzZXNzaW9uKSB7CiAgICAgICAgICBzZXRVc2VyKHNlc3Npb24udXNlcik7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgaW5pdGlhbCBzZXNzaW9uOicsIGVycm9yKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICBzZXRMb2FkaW5nKGZhbHNlKTsKICAgICAgfQogICAgfTsKCiAgICBnZXRJbml0aWFsU2Vzc2lvbigpOwoKICAgIC8vIFN1YnNjcmliZSB0byBhdXRoIGNoYW5nZXMKICAgIGNvbnN0IHsgZGF0YTogeyBzdWJzY3JpcHRpb24gfSB9ID0gc3VwYWJhc2UuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZSgKICAgICAgKF9ldmVudCwgc2Vzc2lvbikgPT4gewogICAgICAgIGlmIChzZXNzaW9uPy51c2VyPy5pZCAhPT0gdXNlcj8uaWQpIHsKICAgICAgICAgIHNldFVzZXIoc2Vzc2lvbj8udXNlciA/PyBudWxsKTsKICAgICAgICB9CiAgICAgICAgc2V0TG9hZGluZyhmYWxzZSk7CiAgICAgIH0KICAgICk7CgogICAgcmV0dXJuICgpID0+IHsKICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7CiAgICB9OwogIH0sIFt1c2VyPy5pZF0pOyAvLyBPbmx5IGRlcGVuZCBvbiB1c2VyIElEIGNoYW5nZXMKCiAgcmV0dXJuICgKICAgIDxBdXRoQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17eyB1c2VyLCBsb2FkaW5nIH19PgogICAgICB7Y2hpbGRyZW59CiAgICA8L0F1dGhDb250ZXh0LlByb3ZpZGVyPgogICk7Cn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VBdXRoKCkgewogIHJldHVybiB1c2VDb250ZXh0KEF1dGhDb250ZXh0KTsKfQ==